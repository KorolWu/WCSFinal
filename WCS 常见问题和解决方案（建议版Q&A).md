# WCS 常见问题和解决方案（简易版Q&A)



##### 1,关于任务执行故障后，wcs的响应以及对应操作？

答：出现故障后，第一时间退出当前的任务，执行该任务的小车状态(status = 2)至为异常，该小车不可以再接受任务，在小车列表上，该小车后面会出现红色的Reset按钮，确认小车状态无误后点击该按钮，小车状态(status = 3)至为可接受指令，可正常接受任务。

------

##### 2,关于通讯异常，wcs的相应和对应操作

1. ###### 发送指令到硬件，但未得到回复

   ​		与硬件通讯采用的是一问一答机制，其中状态指令是一直在请求的，常常会出现问出去硬件并没有及时回复，为了增加容错率，在硬件未能及时回复的情况下，我们会再次请求，但是我们有个容器一直在记录这种异常情况，当累计出现10次请求未能回复的时候，我们会将这个视为严重通讯异常，主动停止与该小车通讯，停止该小车的使用，需要用户手动解除该异常。

2. ###### 当出现粘包，或异常帧时

   ​		有处理粘包机制，并将出现粘包的时间记录在日志里面，当出现异常帧（帧长度在我们规定范围内，但索引号不对时，我们不在分析该帧，并将此异常记录在日志里。

```c++
    if(sql_open_err == "")
    {
        m_updatestoretimer->start(1000);
        m_updateComTimer->start(100);
        m_pMainWidget->StartUpdateShowInfo();
    }
```

### 关于小车、电梯硬件、流道硬件的信息在设计过程中重复的问题？

通讯类数据表配置了所有的硬件信息，内存动态信息访问到的内容;key唯一，读到的数据要各自关联起来，小车的动态数据（运行过程中小车的数据随时更新）和静态数据（通讯配置一旦打开程序之后不会再更改）

#### 关于地图路径模拟运行逻辑？

地图显示的逻辑实现步骤

首先根据货架的位置筛选出最大值和最小值

计算屏幕的像素

设定画布的大小

根据最小值来计算像素系数,

根据比例设定位置与像素的比例关系，K

根据得到的位置值*k得到所在画布的位置

### 累积误差问题点？

如果轨迹是连续+或者-的时候像素出现累积误差，在屏幕显示不准，需要寻求其他的方案进行改善模拟过程？如何把坐标与像素的位置进行关联的问题？由于小车给出的一直是相对运动，累积误差明显

### 改善动画模拟方式？

使用动画模式模拟小车运行的轨迹，拟采用如下方式进行

```
   //怎样动需要QTimeLiness函数 事件线函数实现动画效果
   QTimeLine *timeline = new QTimeLine(3000);      //持续三秒钟
   timeline->setLoopCount(1);                      //设置循环次数
   animation->setTimeLine(timeline);
   //animation->rotationAt(180);
   qDebug()<<"rect:"<< m_caritem->rect().x() <<  m_caritem->x() << m_caritem->rect().width();
   //animation->setTranslationAt(0.1, m_caritem->rect().x(), -200);
   animation->setTranslationAt(0.1, m_caritem->x(), -200);
   animation->setPosAt(1,QPointF(m_caritem->x(), -200)); //第一个参数代表时间系数*时间线参数 例 上面3s如果是0.1 过程就要300ms完成
   timeline->start(); //时间线启动
```

### 关于看板信息数据获取的问题，库位信息数据是内存部分，报警记录表格信息是直接查询的数据库？

实现方式的是每隔5s进行数据库数据查询？比较费时？查询时间不定 经实测有时最长一条需要200ms以上？



### 2021-01-28 一楼仓库测试问题点复盘

1.任务结构体修改以站号为key方式;

2.实现流道自动扫码入库的方式;

3.postman自动下发模拟wms下发任务;

问题：

1）扫码枪与流道站号关联的问题;

2）扫码逻辑出现串口接收延时的bug; 需要继续实测 线程的睡眠会影响，扫码逻辑放行之后需要延时一会，需要更改逻辑

3) 当前任务删除逻辑和界面显示的问题;已解决

4）数据库出现goneaway;

5) 出库任务队列出现重复的料箱号，队列进行重复判断，但是一旦任务已经在进行中，重复的无法进行判断;

6)扫码接收会出现06字符，暂时定义不进行数据转出

